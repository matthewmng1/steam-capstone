{"ast":null,"code":"import _regeneratorRuntime from\"/Users/matthewng/Desktop/springboard/Capstones/Capstone-2/steam-capstone/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/matthewng/Desktop/springboard/Capstones/Capstone-2/steam-capstone/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/matthewng/Desktop/springboard/Capstones/Capstone-2/steam-capstone/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect}from\"react\";import{BrowserRouter}from\"react-router-dom\";import useLocalStorage from\"./hooks/useLocalStorage\";import Routes from\"./routes/Routes\";import Navigation from\"./routes/Navigation\";import SteamDbApi from\"./api/api\";import UserContext from\"./auth/UserContext\";import jwt from\"jsonwebtoken\";import\"./App.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var TOKEN_STORAGE_ID=\"steamdb-token\";function App(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),infoLoaded=_useState2[0],setInfoLoaded=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),currentUser=_useState4[0],setCurrentUser=_useState4[1];var _useLocalStorage=useLocalStorage(TOKEN_STORAGE_ID),_useLocalStorage2=_slicedToArray(_useLocalStorage,2),token=_useLocalStorage2[0],setToken=_useLocalStorage2[1];console.debug(\"App\",\"currentUser=\",currentUser,\"token=\",token);useEffect(function loadUserInfo(){console.debug(\"App useEffect loadUserInfo\",\"token=\",token);function getCurrentUser(){return _getCurrentUser.apply(this,arguments);}function _getCurrentUser(){_getCurrentUser=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var _jwt$decode,username,_currentUser;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:if(!token){_context.next=14;break;}_context.prev=1;_jwt$decode=jwt.decode(token),username=_jwt$decode.username;SteamDbApi.token=token;_context.next=6;return SteamDbApi.getCurrentUser(username);case 6:_currentUser=_context.sent;setCurrentUser(_currentUser);_context.next=14;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](1);console.error(\"App loadUserInfo: problem loading\",_context.t0);setCurrentUser(null);case 14:setInfoLoaded(true);case 15:case\"end\":return _context.stop();}},_callee,null,[[1,10]]);}));return _getCurrentUser.apply(this,arguments);}setInfoLoaded(false);getCurrentUser();},[token]);function signup(_x){return _signup.apply(this,arguments);}function _signup(){_signup=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(signupData){var _token;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return SteamDbApi.signup(signupData);case 3:_token=_context2.sent;setToken(_token);return _context2.abrupt(\"return\",{success:true});case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](0);console.error(\"signup failed\",_context2.t0);return _context2.abrupt(\"return\",{success:false,e:_context2.t0});case 12:case\"end\":return _context2.stop();}},_callee2,null,[[0,8]]);}));return _signup.apply(this,arguments);}function login(_x2){return _login.apply(this,arguments);}function _login(){_login=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(loginData){var _token2;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return SteamDbApi.login(loginData);case 3:_token2=_context3.sent;setToken(_token2);return _context3.abrupt(\"return\",{success:true});case 8:_context3.prev=8;_context3.t0=_context3[\"catch\"](0);console.error(\"login failed\",_context3.t0);return _context3.abrupt(\"return\",{success:false,e:_context3.t0});case 12:case\"end\":return _context3.stop();}},_callee3,null,[[0,8]]);}));return _login.apply(this,arguments);}function logout(){setCurrentUser(null);setToken(null);localStorage.removeItem(\"searchedAppData\");localStorage.removeItem(\"searchTerm\");}if(!infoLoaded)return;return/*#__PURE__*/_jsx(BrowserRouter,{children:/*#__PURE__*/_jsx(UserContext.Provider,{value:{currentUser:currentUser,setCurrentUser:setCurrentUser},children:/*#__PURE__*/_jsxs(\"div\",{className:\"App\",children:[/*#__PURE__*/_jsx(Navigation,{logout:logout}),/*#__PURE__*/_jsx(Routes,{login:login,signup:signup})]})})});}export default App;","map":{"version":3,"names":["React","useState","useEffect","BrowserRouter","useLocalStorage","Routes","Navigation","SteamDbApi","UserContext","jwt","jsx","_jsx","jsxs","_jsxs","TOKEN_STORAGE_ID","App","_useState","_useState2","_slicedToArray","infoLoaded","setInfoLoaded","_useState3","_useState4","currentUser","setCurrentUser","_useLocalStorage","_useLocalStorage2","token","setToken","console","debug","loadUserInfo","getCurrentUser","_getCurrentUser","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee","_jwt$decode","username","_currentUser","wrap","_callee$","_context","prev","next","decode","sent","t0","error","stop","signup","_x","_signup","_callee2","signupData","_token","_callee2$","_context2","abrupt","success","e","login","_x2","_login","_callee3","loginData","_token2","_callee3$","_context3","logout","localStorage","removeItem","children","Provider","value","className"],"sources":["/Users/matthewng/Desktop/springboard/Capstones/Capstone-2/steam-capstone/src/App.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { BrowserRouter } from \"react-router-dom\";\nimport useLocalStorage from \"./hooks/useLocalStorage\";\nimport Routes from \"./routes/Routes\"\nimport Navigation from \"./routes/Navigation\";\nimport SteamDbApi from \"./api/api\";\nimport UserContext from \"./auth/UserContext\";\nimport jwt from \"jsonwebtoken\"\nimport \"./App.css\"\n\nexport const TOKEN_STORAGE_ID = \"steamdb-token\";\n\nfunction App() {\n  const [infoLoaded, setInfoLoaded] = useState(false);\n  const [currentUser, setCurrentUser] = useState(null)\n  const [token, setToken] = useLocalStorage(TOKEN_STORAGE_ID);\n\n  console.debug(\n    \"App\",\n    \"currentUser=\", currentUser,\n    \"token=\", token,\n  );\n\n  useEffect(function loadUserInfo() {\n    console.debug(\"App useEffect loadUserInfo\", \"token=\", token);\n\n    async function getCurrentUser(){\n      if(token){\n        try{\n          let{ username } = jwt.decode(token)\n          SteamDbApi.token = token;\n          let currentUser = await SteamDbApi.getCurrentUser(username)\n          setCurrentUser(currentUser);\n        } catch (e) {\n          console.error(\"App loadUserInfo: problem loading\", e);\n          setCurrentUser(null);\n        }\n      }\n      setInfoLoaded(true);\n    }\n    setInfoLoaded(false);\n    getCurrentUser();\n  }, [token]);\n\n  async function signup(signupData){\n    try{\n      let token = await SteamDbApi.signup(signupData);\n      setToken(token)\n      return {success: true };\n    } catch(e){\n      console.error(\"signup failed\", e);\n      return {success: false, e};\n    }\n  }\n\n  async function login(loginData){\n    try{\n      let token = await SteamDbApi.login(loginData);\n      setToken(token)\n      return {success:true};\n    }catch(e){\n      console.error(\"login failed\", e);\n      return {success: false, e};\n    }\n  }\n\n  function logout() {\n    setCurrentUser(null);\n    setToken(null);\n    localStorage.removeItem(\"searchedAppData\");\n    localStorage.removeItem(\"searchTerm\")\n\n  }\n\n  \n  if(!infoLoaded) return;\n\n  return (\n    <BrowserRouter>\n        <UserContext.Provider\n            value={{ currentUser, setCurrentUser}}>\n          <div className=\"App\">\n            <Navigation logout={logout} />\n            <Routes login={login} signup={signup}/>\n          </div>\n          </UserContext.Provider>\n    </BrowserRouter>\n  );\n}\n\nexport default App;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}