{"ast":null,"code":"import _regeneratorRuntime from\"/Users/matthewng/Desktop/springboard/Capstones/Capstone-2/steam-capstone/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/matthewng/Desktop/springboard/Capstones/Capstone-2/steam-capstone/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/matthewng/Desktop/springboard/Capstones/Capstone-2/steam-capstone/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useState,useContext}from\"react\";import{useParams}from\"react-router-dom\";import SteamDbApi from\"../api/api\";import AppNewsCard from\"./AppNewsCard\";import UserContext from\"../auth/UserContext\";import\"./AppNews.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function AppNews(){var _useContext=useContext(UserContext),currentUser=_useContext.currentUser,setCurrentUser=_useContext.setCurrentUser;var _useParams=useParams(),appid=_useParams.appid;var userid=currentUser.id;console.debug(\"AppNews\");var _useState=useState(null),_useState2=_slicedToArray(_useState,2),news=_useState2[0],setNews=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),buttonState=_useState4[0],setButtonState=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),name=_useState6[0],setName=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),url=_useState8[0],setUrl=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),backgroundImageUrl=_useState10[0],setBackgroundImageUrl=_useState10[1];var _useState11=useState(\"\"),_useState12=_slicedToArray(_useState11,2),imgUrl=_useState12[0],setImgUrl=_useState12[1];useEffect(function getAppNewsItems(){function getNews(){return _getNews.apply(this,arguments);}function _getNews(){_getNews=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var res;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.next=2;return SteamDbApi.getAppNews(appid);case 2:res=_context.sent;setNews(res.news);case 4:case\"end\":return _context.stop();}},_callee);}));return _getNews.apply(this,arguments);}getNews();},[appid]);useEffect(function(){function checkDb(){return _checkDb.apply(this,arguments);}function _checkDb(){_checkDb=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var data,res,found;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:data={appid:parseInt(appid),userid:userid};_context2.next=3;return SteamDbApi.getFavoritedApps();case 3:res=_context2.sent;found=res.find(function(favorite){return favorite.appid===data.appid&&favorite.userid===data.userid;});if(!found){_context2.next=7;break;}return _context2.abrupt(\"return\",setButtonState(true));case 7:case\"end\":return _context2.stop();}},_callee2);}));return _checkDb.apply(this,arguments);}checkDb();},[]);useEffect(function(){function getAppDetails(){return _getAppDetails.apply(this,arguments);}function _getAppDetails(){_getAppDetails=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(){var data;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:_context3.next=2;return SteamDbApi.getAppDetails(appid);case 2:data=_context3.sent;setName(data.name);setUrl(\"/news/\".concat(appid));setImgUrl(data.header_image);setBackgroundImageUrl(data.backgroundImageUrl);case 7:case\"end\":return _context3.stop();}},_callee3);}));return _getAppDetails.apply(this,arguments);}getAppDetails();},[]);// onclick (to add), also post data to favorites table\n// onclick (to remove), also remove data from favorites table\nfunction btnClick(){return _btnClick.apply(this,arguments);}function _btnClick(){_btnClick=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4(){var btndata,res,_res;return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:btndata={appid:appid,userid:userid,name:name,url:url,backgroundImageUrl:backgroundImageUrl};_context4.prev=1;if(!(buttonState===false)){_context4.next=7;break;}_context4.next=5;return SteamDbApi.addAppToDash(appid,btndata);case 5:res=_context4.sent;setButtonState(true);case 7:if(!(buttonState===true)){_context4.next=12;break;}_context4.next=10;return SteamDbApi.removeAppFromDash(appid,btndata);case 10:_res=_context4.sent;setButtonState(false);case 12:_context4.next=17;break;case 14:_context4.prev=14;_context4.t0=_context4[\"catch\"](1);throw new Error(_context4.t0);case 17:case\"end\":return _context4.stop();}},_callee4,null,[[1,14]]);}));return _btnClick.apply(this,arguments);}if(!news)return;return/*#__PURE__*/_jsxs(\"div\",{className:\"appnews\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"appnews-header\",children:[/*#__PURE__*/_jsx(\"img\",{className:\"appnews-img\",src:imgUrl}),/*#__PURE__*/_jsx(\"div\",{className:\"btn-container\",children:/*#__PURE__*/_jsx(\"button\",{className:\"dash-button\",onClick:btnClick,children:!buttonState?\"Add to Dash\":\"Remove from Dash\"})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"appnews-container\",children:news.length?/*#__PURE__*/_jsx(\"ul\",{className:\"appnews-list\",children:news.map(function(n){return/*#__PURE__*/_jsx(AppNewsCard,{title:n.title,url:n.url,author:n.author},n.gid);})}):/*#__PURE__*/_jsx(\"p\",{children:\"No recent news\"})}),/*#__PURE__*/_jsx(\"div\",{})]});}export default AppNews;","map":{"version":3,"names":["React","useEffect","useState","useContext","useParams","SteamDbApi","AppNewsCard","UserContext","jsx","_jsx","jsxs","_jsxs","AppNews","_useContext","currentUser","setCurrentUser","_useParams","appid","userid","id","console","debug","_useState","_useState2","_slicedToArray","news","setNews","_useState3","_useState4","buttonState","setButtonState","_useState5","_useState6","name","setName","_useState7","_useState8","url","setUrl","_useState9","_useState10","backgroundImageUrl","setBackgroundImageUrl","_useState11","_useState12","imgUrl","setImgUrl","getAppNewsItems","getNews","_getNews","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee","res","wrap","_callee$","_context","prev","next","getAppNews","sent","stop","checkDb","_checkDb","_callee2","data","found","_callee2$","_context2","parseInt","getFavoritedApps","find","favorite","abrupt","getAppDetails","_getAppDetails","_callee3","_callee3$","_context3","concat","header_image","btnClick","_btnClick","_callee4","btndata","_res","_callee4$","_context4","addAppToDash","removeAppFromDash","t0","Error","className","children","src","onClick","length","map","n","title","author","gid"],"sources":["/Users/matthewng/Desktop/springboard/Capstones/Capstone-2/steam-capstone/src/steamapps/AppNews.js"],"sourcesContent":["import React, { useEffect, useState, useContext } from \"react\";\nimport { useParams } from \"react-router-dom\";\nimport SteamDbApi from \"../api/api\";\nimport AppNewsCard from \"./AppNewsCard\";\nimport UserContext from \"../auth/UserContext\";\nimport \"./AppNews.css\"\n\n\nfunction AppNews(){\n  const { currentUser, setCurrentUser } = useContext(UserContext);\n  const {appid} = useParams();\n  let userid = currentUser.id;\n  console.debug(\"AppNews\")\n\n  const [news, setNews] = useState(null)\n  const [buttonState, setButtonState] = useState(false)\n\n  const [name, setName] = useState(\"\")\n  const [url, setUrl] = useState(\"\")\n  const [backgroundImageUrl, setBackgroundImageUrl] = useState(\"\")\n  const [imgUrl, setImgUrl] = useState(\"\")\n\n  useEffect(function getAppNewsItems(){\n    async function getNews(){\n      let res = await SteamDbApi.getAppNews(appid)\n      setNews(res.news);\n    }\n    getNews();\n  }, [appid])\n\n  useEffect(() => {\n    async function checkDb(){\n      let data = {appid: parseInt(appid), userid}\n      let res = await SteamDbApi.getFavoritedApps()\n      let found = res.find((favorite) => {\n        return favorite.appid === data.appid && favorite.userid === data.userid;\n      })\n      if(found) return setButtonState(true)\n    }\n    checkDb();\n  }, [])\n\n  useEffect(() => {\n    async function getAppDetails(){\n      let data = await SteamDbApi.getAppDetails(appid)\n      setName(data.name)\n      setUrl(`/news/${appid}`)\n      setImgUrl(data.header_image)\n      setBackgroundImageUrl(data.backgroundImageUrl)\n    }\n    getAppDetails();\n  }, [])\n\n  // onclick (to add), also post data to favorites table\n  // onclick (to remove), also remove data from favorites table\n\n  async function btnClick(){\n    let btndata = {appid, userid, name, url, backgroundImageUrl}\n    try{\n      if(buttonState === false){\n        let res = await SteamDbApi.addAppToDash(appid, btndata)\n        setButtonState(true)\n      }\n      if(buttonState === true){\n        let res = await SteamDbApi.removeAppFromDash(appid, btndata)\n        setButtonState(false)\n      }\n    }catch (e){\n      throw new Error(e)\n    }\n  }\n\n  if(!news) return;\n\n  return(\n    <div className=\"appnews\">\n      <div className=\"appnews-header\">\n      <img className=\"appnews-img\" src={imgUrl}></img>\n        <div className=\"btn-container\">\n          <button \n            className=\"dash-button\"\n            onClick={btnClick}>\n          {!buttonState ? \"Add to Dash\" : \"Remove from Dash\" }\n          </button>\n        </div>\n      </div>\n      <div className=\"appnews-container\">\n        {news.length \n          ? (\n            <ul className=\"appnews-list\">\n              {news.map(n => (\n                <AppNewsCard\n                    key={n.gid}\n                    title={n.title}\n                    url={n.url}\n                    author={n.author}\n                />\n                ))}\n            </ul>\n          ) : \n            <p>No recent news</p>}\n          </div>\n        <div>\n      </div>\n    </div>\n  )\n}\n\nexport default AppNews;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}